File.open(ARGV[0], 'r', &:readlines).reverse.each_with_object(Hash.new { |h,k| h[k] = [] }) { |l, o| o[l.strip[0]] << l.chomp }.tap { |i| p i['m'].map { |l| l.split(/\D+/).last(3).map(&:to_i) }.reverse.each_with_object(i['['].map { |l| l.chars.each_slice(4).map { |s| s.join.strip } }.transpose.map { |a| a.reject(&:empty?) }) { |m, c| m[0].times { c[m[2]-1].push(c[m[1]-1].pop) } }.map(&:pop).join.gsub(/\W/,'') }
